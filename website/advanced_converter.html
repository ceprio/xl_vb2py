<html>
    <head>
        <!-- Google stuff -->
        <script async src="https://www.googletagmanager.com/gtag/js?id=UA-23654340-2"></script>
        <script>
            window.dataLayer = window.dataLayer || [];
            function gtag() {
                dataLayer.push(arguments);
            }
            gtag('js', new Date());
            gtag('config', 'UA-23654340-2');
        </script>

        <!-- JS, Popper.js, and jQuery -->
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

        <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
        <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js" integrity="sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI" crossorigin="anonymous"></script>

        <!-- CSS only -->
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css" integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">

        <!-- Page specific includes -->
        
    <title>vb2py Online Conversion</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="stylesheet" type="text/css" href="main.css">

    <!-- Jquery -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.3/ace.js"></script>

    <!-- East UI -->
    <script src="jquery-easyui-1.9.4/jquery.easyui.min.js"></script>
    <link rel="stylesheet" type="text/css" href="jquery-easyui-1.9.4/themes/gray/easyui.css">
    <link rel="stylesheet" type="text/css" href="jquery-easyui-1.9.4/themes/icon.css">

    <!-- ACE -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.3/ace.js"></script>


        <!-- Main CSS for site -->
        <link rel="stylesheet" href="main.css">
    </head>

    <body>
        <!-- Feather icon set -->
        <script src="https://unpkg.com/feather-icons"></script>

        <div class="container main-header">
            <div class="row">
                <div class="col">
                    <div class="main-logo"></div>
                </div>
                <div class="col-8">
                    <div class="container">
                        <div class="row main-title" style="text-align: center">
                            <div class="col">Convert Visual Basic To Python</div>
                        </div>
                        <div class="row"><div class="col">


<div class="container">
    <div class="row">
        <div class="col"><a href="index.html">
            <i data-feather="home"></i> HOME</a></div>
        <div class="col"><a href="online_conversion.html">
            <i data-feather="cpu"></i>&nbsp;CONVERT</a></div>
        <div class="col"><a href="documentation.html">
            <i data-feather="help-circle"></i>&nbsp;DOCS</a></div>
        <div class="col"><a href="roadmap.html">
            <i data-feather="map"></i>&nbsp;ROADMAP</a></div>
        <div class="col"><a href="news.html">
            <i data-feather="calendar"></i>&nbsp;NEWS</a></div>
    </div>
</div></div></div>
                    </div>
                </div>
                <div class="col donate-box">
                    <style>.bmc-button img {
height: 34px !important;
width: 35px !important;
margin-bottom: 1px !important;
box-shadow: none !important;
border: none !important;
vertical-align: middle !important;
}

.bmc-button {
padding: 7px 10px 7px 10px !important;
line-height: 35px !important;
height: 51px !important;
min-width: 217px !important;
text-decoration: none !important;
display: inline-flex !important;
color: #ffffff !important;
background-color: #5F7FFF !important;
border-radius: 5px !important;
border: 1px solid transparent !important;
padding: 7px 10px 7px 10px !important;
font-size: 22px !important;
letter-spacing: 0.6px !important;
box-shadow: 0px 1px 2px rgba(190, 190, 190, 0.5) !important;
-webkit-box-shadow: 0px 1px 2px 2px rgba(190, 190, 190, 0.5) !important;
margin: 0 auto !important;
font-family: 'Cookie', cursive !important;
-webkit-box-sizing: border-box !important;
box-sizing: border-box !important;
-o-transition: 0.3s all linear !important;
-webkit-transition: 0.3s all linear !important;
-moz-transition: 0.3s all linear !important;
-ms-transition: 0.3s all linear !important;
transition: 0.3s all linear !important;
}

.bmc-button:hover, .bmc-button:active, .bmc-button:focus {
-webkit-box-shadow: 0px 1px 2px 2px rgba(190, 190, 190, 0.5) !important;
text-decoration: none !important;
box-shadow: 0px 1px 2px 2px rgba(190, 190, 190, 0.5) !important;
opacity: 0.85 !important;
color: #ffffff !important;
}</style>
<link href="https://fonts.googleapis.com/css?family=Cookie" rel="stylesheet">
<a class="bmc-button" target="_blank" href="https://www.buymeacoffee.com/paulpaterson"><img
    src="https://cdn.buymeacoffee.com/buttons/bmc-new-btn-logo.svg" alt="Buy me a coffee"><span
    style="margin-left:15px;font-size:28px !important;">Buy me a coffee</span></a>

                </div>
            </div>
        </div>
        <div class="header">
            
        </div>

        <div class="container">
            <div class="row">
                
            </div>
        </div>

        

<div style="margin:20px 0 10px 0;"></div>

<div class="easyui-panel" style="width:100%;height:90%;padding:10px;">
    <div class="easyui-layout" data-options="fit:true">
        <div data-options="region:'west',split:true" style="width:10%;" title="Details">
    <div class="btn-toolbar" role="toolbar" aria-label="VB Editor Toolbar" style="padding-bottom: 2px">
        <div class="btn-group btn-group-sm mr-2" role="group" aria-label="detail-buttons">
            <button type="button" class="btn btn-secondary">
                <i data-toggle="tooltip" title="Show the parsing issues" data-feather="alert-circle" height="20px"></i>
                <span class="button-label"> Errors</span>
            </button>

            <button type="button" class="btn btn-secondary">
                <i data-toggle="tooltip" title="Show the code structure" data-feather="layers" height="20px"></i>
                <span class="button-label"> Structure</span>
            </button>

        </div>
    </div>

    <div id="error-list">

    </div>

</div>


<script>

    function get_content_menu_item(line_text, line_vb, line_py) {
        let short_name = line_text;
        if (name.length > 25) {
            short_name = name.substring(0, 25) + ' ...';
        }
        let text = '<a href="#" onclick="move_to(' + line_vb + ', ' + line_py + ')">' + short_name + '</a>';
        return text;
    }

    function move_to(vb_line, py_line) {
        vbeditor.scrollToLine(vb_line);
        vbeditor.selection.clearSelection();
        vbeditor.moveCursorToPosition({row: vb_line, col: 0});
        vbeditor.selection.selectLine();

        pyeditor.scrollToLine(py_line);
    }

    function create_tree_from_structure(structure, vb_error_lines, py_error_lines, selection_offset) {
        html = '<ul id="tree" class="easyui-tree">';
        if (vb_error_lines !== null) {
            html += '<li><span>Parsing Issues</span><ul>' +
                    get_error_nodes(vb_error_lines, py_error_lines, selection_offset) +
                    '</ul></li>';
        };
        if (structure.length !== 0) {
            html += '<li><span>Structure</span><ul>' +
                    get_tree_nodes(structure) +
                    '</ul></li>';
        };
        html += '</ul>';
        $('#error-list')[0].innerHTML = html;
        $('#tree').tree();
    }

    function get_tree_nodes(structure) {
        let html = '';
        structure.forEach(function (item, index) {
            let children_html = get_tree_nodes(item[5]);
            html += '<li><span>' +
                    get_content_menu_item(
                        item[2],
                        item[0],
                        -1
                    ) +
                    '</span><ul>' +
                    children_html +
                    '</ul></li>';
        });
        return html;
    }

    function get_error_nodes(vb_error_lines, py_error_lines, selection_offset) {
        let html = '';
        if (vb_error_lines) {
            for (let i = 0; i < vb_error_lines.length; i++) {
                let vb_offset = vb_error_lines[i] + selection_offset;
                let py_offset = py_error_lines[i];
                html += '<li data-options="iconCls:\'icon-cancel\'"><span>' +
                        get_content_menu_item(
                                vbeditor.session.getLine(vb_offset),
                                vb_offset,
                                py_offset
                        ) +
                        '</span><ul></ul></li>'
            }
        }
        return html;
    }

</script>
        <div data-options="region:'center', split:true" style="width:50%" title="Enter VB Code Here">
    <div class="btn-toolbar" role="toolbar" aria-label="VB Editor Toolbar" style="padding-bottom: 2px">
        <div class="btn-group btn-group-sm mr-2" role="group" aria-label="vb-content-buttons">

            <button type="button" class="btn btn-secondary"
                    data-toggle="modal" data-target="#load-file-modal"
            >
                <i data-feather="folder" height="20px" data-toggle="tooltip" title="Load a VB file from your computer"></i>
                <span class="button-label">
                    &nbsp;Load
                </span>
            </button>

            <button id="paste-button" type="button" class="btn btn-secondary"
                    data-toggle="tooltip" title="Paste and convert from clipboard"
                    style="display: none" onclick="pasteCode()"
            >
                <i data-feather="clipboard" height="20px"></i><span class="button-label"> Paste</span>
            </button>

            <button id="ExampleGroup" type="button"
                    class="btn-small btn-secondary dropdown-toggle" data-toggle="dropdown"
                    aria-haspopup="true" aria-expanded="false">
                <i data-feather="file-text" height="20px" data-toggle="tooltip" title="Insert some example VB code"></i><span class="button-label"> Examples</span>
            </button>

            <div class="dropdown-menu" aria-labelledby="ExampleGroup">
                        <a class="dropdown-item" href="#" onclick="getExample('general')">General</a>
                        <div class="dropdown-divider"></div>
                        <a class="dropdown-item" href="#" onclick="getExample('if')">If</a>
                        <a class="dropdown-item" href="#" onclick="getExample('with')">With</a>
                        <a class="dropdown-item" href="#" onclick="getExample('select')">Select</a>
                        <a class="dropdown-item" href="#" onclick="getExample('for')">For</a>
                        <a class="dropdown-item" href="#" onclick="getExample('while')">While</a>
                        <a class="dropdown-item" href="#" onclick="getExample('dim')">Dim</a>
                        <a class="dropdown-item" href="#" onclick="getExample('try')">Try</a>
                        <div class="dropdown-divider"></div>
                        <a class="dropdown-item" href="#" onclick="getExample('sub')">Sub</a>
                        <a class="dropdown-item" href="#" onclick="getExample('fn')">Fn</a>
                        <div class="dropdown-divider"></div>
                        <a class="dropdown-item" href="#" onclick="getExample('type')">Type</a>
                        <a class="dropdown-item" href="#" onclick="getExample('enum')">Enum</a>
                        <div class="dropdown-divider"></div>
                        <a class="dropdown-item" href="#" onclick="getExample('properties')">Properties</a>
                        <a class="dropdown-item" href="#" onclick="getExample('class')">Class</a>
                        <a class="dropdown-item" href="#" onclick="getExample('open')">Open</a>
                        <a class="dropdown-item" href="#" onclick="getExample('using')">Using</a>
            </div>

        </div>
        <div class="btn-group btn-group-sm mr-2" role="group" aria-label="vb-convert-buttons">
            <button type="button" class="btn btn-primary" onclick="convert_code('All')"
                    data-toggle="tooltip" title="Convert all the code to Python">
                <i data-feather="chevrons-right" height="20px"></i><span class="button-label"> Convert</span>
            </button>
            <button type="button" class="btn btn-secondary" onclick="convert_selection()"
                    data-toggle="tooltip" title="Convert current selection to Python">
                <i data-feather="chevron-right" height="20px"></i><span class="button-label"> Selection</span>
            </button>
        </div>
    </div>
    <div id="vbcode" class="vbcode">
        VBCode
    </div>

</div>

<!-- Small options panel -->
<div id="options-panel" class="collapse" style="padding-right: 20px">
    <div class="form-group row" align="center"> <!-- Context -->
        <label class="col-sm-2 col-form-label">
            Dialect
        </label>
        <select class="form-control col-sm-2" id="dialect">
            <option selected value="detect">Auto detect</option>
            <option value="VB6">VB6</option>
            <option value="VB.NET">VB.NET</option>
            <option value="VBA">VBA (Excel)</option>
            <option value="VBScript">VB Script</option>
        </select>

        <label class="col-sm-2 col-form-label">
            Parsing Type
        </label>
        <select class="form-control col-sm-2" id="failure-mode">
            <option selected value="fail-safe">Fast</option>
            <option value="line-by-line">Fallback</option>
        </select>

        <label class="col-sm-2 col-form-label">
            Conversion Type
        </label>
        <select class="form-control col-sm-2" id="type">
            <option selected value="pythonic">Pythonic code</option>
            <option value="exact">Match VB exactly</option>
        </select>

        <label class="col-sm-2 col-form-label">
            Context
        </label>
        <select class="form-control col-sm-2" id="context">
            <option selected value="code">Code module</option>
            <option value="class">Class module</option>
            <option value="form">Form module</option>
        </select>
        <label class="col-sm-2 col-form-label">
            Class Name
        </label>
        <input class="col-sm-2" id="class-name" value="MyClass"/>

        <label class="col-sm-2 col-form-label">
            Advanced Options
        </label>
        <button id="advanced-options-button" type="button" class="col-sm-2 btn btn-info"
                data-toggle="modal" data-target="#conversion-options" value="Open"
                onclick="recordOptionsOpen()">
            Open ...
        </button>
    </div>
</div>


<script>
    $(document).ready(function () {
        navigator.permissions.query({name: 'clipboard-read'}).then(result => {
            $('#paste-button').show();
        });
    });

    function pasteCode() {
        navigator.permissions.query({name: 'clipboard-read'}).then(result => {
            // If permission to read the clipboard is granted or if the user will
            // be prompted to allow it, we proceed.

            if (result.state === 'granted' || result.state === 'prompt') {
                navigator.clipboard.readText()
                    .then(text => {
                        vbeditor.selectAll();
                        vbeditor.insert(text);
                        vbeditor.selection.clearSelection();

                        if (!DEVELOPMENT) {
                            gtag('event', 'Paste VB', {
                                'event_category': 'UI',
                            });
                        }

                        convert_code('All');
                    })
                    .catch(err => {
                        console.error('Failed to read clipboard contents: ', err);
                    });
            } else {
                alert('Unable to paste from clipboard (probably browser security settings)');
            }
        });
    }
</script>
        <div data-options="region:'east',split:true" style="width:40%" title="Python Code Will Appear Here">
    <div class="btn-toolbar" role="toolbar" aria-label="VB Editor Toolbar" style="padding-bottom: 2px">
        <div class="btn-group btn-group-sm mr-2" role="group" aria-label="py-content-buttons">
            <button type="button" class="btn btn-secondary" onclick="recordOptionsOpen()"
                    data-toggle="modal" data-target="#conversion-options" value="Open">
                <i data-toggle="tooltip" title="Edit options to control the conversion" data-feather="settings" height="20px"></i><span class="button-label"> Options</span>
            </button>
        </div>

        <div class="btn-group btn-group-sm mr-2" role="group" aria-label="py-get">
            <button type="button" class="btn btn-secondary" onclick="copyPython()"
                    data-toggle="tooltip" title="Copy converted code to clipboard">
                <i data-feather="copy" height="20px"></i><span class="button-label"> Copy</span>
            </button>
            <button id="PyButtonsGroup" type="button"
                    class="btn-small btn-secondary dropdown-toggle" data-toggle="dropdown"
                    aria-haspopup="true" aria-expanded="false">
                <i data-feather="download" height="20px" data-toggle="tooltip" title="Download converted code"></i><span class="button-label"> Download</span>
            </button>
            <div class="dropdown-menu" aria-labelledby="PyButtonsGroup">
                <a class="dropdown-item" href="#" onclick="downloadPython()">Code (.py)</a>
                <a class="dropdown-item" href="#" onclick="downloadAll()">Code + Runtime (.zip)</a>
            </div>
        </div>

    </div>

    <div id="pycode" class="pycode">
    </div>
</div>

<script>

    function copyPython() {
        let sel = pyeditor.selection.toJSON();
        if (pyeditor.selection.isEmpty()) {
            pyeditor.selectAll();
        }
        pyeditor.focus();
        document.execCommand('copy');
        pyeditor.selection.fromJSON(sel);
        if (!DEVELOPMENT) {
            gtag('event', 'Copy Python', {
                'event_category': 'UI',
            });
        }
    }

    //region Download artifacts
    function downloadPython() {
        let element = document.createElement('a');
        let text = pyeditor.session.getValue();
        element.setAttribute('href', 'data:text/plain;charset=utf-8,' + encodeURIComponent(text));
        element.setAttribute('download', 'converted_code.py');

        element.style.display = 'none';
        document.body.appendChild(element);

        element.click();

        document.body.removeChild(element);

        if (!DEVELOPMENT) {
            gtag('event', 'Download Python', {
                'event_category': 'Converted Python',
            });
        }
    }

    function downloadAll() {
        let element = document.createElement('a');
        $.post(HOST + '/get_runtime_zip', {'code': pyeditor.session.getValue()}, function (data) {
            if (data.status === 'OK') {
                element.setAttribute('href', 'data:application/zip;base64,' + data.zipdata);
                element.setAttribute('download', 'converted_code.zip');

                element.style.display = 'none';
                document.body.appendChild(element);
                element.click();
                document.body.removeChild(element);

                if (!DEVELOPMENT) {
                    gtag('event', 'Download Python', {
                        'event_category': 'Converted Python + Runtime',
                    });
                }
            } else {
                alert('Failed to create ZIP');
            }
        }, 'json')
                .fail(function () {
                    alert('Could not reach server');
                })
    }

    //endregion

</script>
    </div>
</div>


<div style="display: none">
                <div id="ex-general">
            
Dim A as Integer
B = 20

Sub DotIt(X as Double)
    Select Case A
        Case 1
            B = B + X
        Case 2
            B = B - X
        Case Else
            B = 0
    End Select
End Sub

Function GetHalfB() As Integer
    GetHalfB = B / 2
End Function
    
            </div>
                <div id="ex-if">
            

'
' Multi-line and singe-line ifs are converted to blocks in Python
If A = 10 Then
    DoSomething()
ElseIf B = 20 Then
    DoSomethingElse()
Else
    OtherCase()
If B = 20 Then C = 0 Else C = 1
End If
    
            </div>
                <div id="ex-with">
            

'
' With statements allow quick access to properties and methods
' of an object. These will be translated into explicit calls to
' a temporary object (in case of side-effects)
With Container.Member
    .Init
    .IncrementCounter 43
    With .ChildItem
        .Refresh
    End With
End With
    
            </div>
                <div id="ex-select">
            

'
' Selects are converted to If blocks with a temporary variable to
' hold the tested variables (in case of side-effects). Case ranges
' and options are handled as additional clauses for the if
Select Case A
    Case 1
        B = B + X
    Case 2
        B = B - X
        Select Case B
            Case 0 to 10
                C = 1
            Case 11, 12
                C = 2
        End Select
    Case Else
        B = 0
End Select
    
            </div>
                <div id="ex-for">
            

'
' Numeric for loops use a helper function to create the underlying
' sequence to be iterated over
For I = 1 To 10
    B = B + 1
    For J = 10 To 0 Step -1
        If B = 20 Then Exit For
    Next J
Next I

'
' For Each relies on the underlying object supporting the iteration
' protocol (which might not be the case!)
For Each Child in Parent
    Child.CleanUp
Next
    
            </div>
                <div id="ex-while">
            

'
' While and Do loops are converted to a Python while
' block.
While Something %3C%3E 10
    Something = Something + 1
Wend

'
' A starting until clause reverses the condition
Do Until Something = 5
    Something = Something - 1
Loop

'
' A final Until clause will generate an If with a break
Do
    Something = Something - 1
Loop Until Something = 0
    
            </div>
                <div id="ex-dim">
            
'
' Dim statements define the types of variables and perform initialisation
' and so are mapped to helper functions which create python objects that
' try to behave like the VB equivalents
Dim A
Dim B as Integer, C As String
A = 10: B = 30: C = "Hello World"

'
' Where arrays are defined these use a helper function which creates
' a variant of a list which has initial values
Dim D(10) As String, E(10, 2, 3) As MyClass

D(5) = "Hello"
E(1, 1, 2) = New MyClass(20)

'
' ReDim statements use the helper function to resize the underlying list
' objects while retaining the size
ReDim Preserve D(5)
ReDim C(20)

    
            </div>
                <div id="ex-try">
            
'
' Try ... Catch statements are converted to try ... except blocks
Try
    a = 1 / 0
Catch ZeroDivisionError As Err
    a = 1000
Finally
    b = 1
End Try

'
' If an Exit Try is found then an additional try ... except is created
' to allow breaking out of the current Except clause
Try
    a = 1 / 0
Catch
    a = 1000
    Exit Try
    b = 2000
Finally
    b = 1
End Try

'
' If there is a "When" clause then this is implemented as an If block 
' However, the behaviour is not likely to be identical in Python in the
' current implementation
a = 1
Try
    a = 1 / 0
Catch ZeroDivisionError When a = 1
    a = 1000
    b = 2000
Finally
    b = 1
End Try

    
            </div>
                <div id="ex-sub">
            
'
' Subroutines are converted to Python functions and can
' include optional parameters with defaults
'
' An optional parameter with no default uses the helper
' object VBMissingArgument and the helper function IsMissing
Sub MySub(X, Optional Y, Optional Z=20)
    Dim subLocal
    If IsMissing(Y) Then Y = 12
    subLocal = X + Y + Z + moduleGlobal
End Sub

MySub 1, 2
MySub 1, Z:=10

'
' Passing by Value converts but behaves differently for
' immutable types in Python.
Sub DoIt(x, ByVal y)
    x = x + 1
    y = y + 1
End Sub

x = 0
y = 0
DoIt x, y
' x is now 1, y is still 0
    
            </div>
                <div id="ex-fn">
            
'
' Functions use a variable to store the result of the
' function during its execution
Function MyFunc(X, Optional Y, Optional Z=20)
    Dim subLocal
    subLocal = X + Y + Z
    MyFunc = subLocal*10
End Function

a = MyFunc(1, 2)
a = MyFunc(1, Z:=10)
    
            </div>
                <div id="ex-type">
            
'
' Types create classes with properties to store the
' values of the types
Type Point
    X As Single
    Y As Single
End Type
'
Type Line2D
    Start As Point
    Finish As Point
End Type
'
Dim p1 As Point, p2 As Point
p1.X = 10
p1.Y = 20
p2.X = 30
p3.Y = 40
'
Dim l1 As Line2D
l1.Start = p1
l1.Finish = p2

    
            </div>
                <div id="ex-enum">
            
'
' Enums create variables with the same names
Enum Number
    One = 1
    Two = 2
    Three = 3
    Four = 4
    Ten = 10
    Hundred = 100
End Enum

Enum Day
    Mon
    Tue
    Wed
    Thu
    Fri
End Enum
    
            </div>
                <div id="ex-properties" context="class">
            
'
' In class modules you can use properties to provide
' accessor functions. These are converted to the Python
' equivalent
Dim myValue = 0

Property Let PriceToPublic(Value As Integer)
    myValue = myValue - Value
    If myValue %3C 0 Then myValue = 0
End Property

Property Get PriceToPublic()
    PriceToPublic = 2 * myValue
End Property

    
            </div>
                <div id="ex-class" context="class">
            

'
' In the context of a class module, dimensioned variables
' are converted to attributes of the class and any
' subroutines and functions are converted to methods
' of the class.
Dim A as Integer
Dim B = 20

Sub DotIt(X as Double)
    Select Case A
        Case 1
            B = B + X
        Case 2
            B = B - X
        Case Else
            B = 0
    End Select
End Sub

Function GetHalfB() As Integer
    GetHalfB = B / 2
End Function
    
            </div>
                <div id="ex-open">
            
'
' File operations using #channels are mapped to a helper
' function that keeps track of the open files
Open "myfile.txt" For Input as #1
Line Input #1, aLine
Close #1

'
' This also handles the writing of files
Open "myOtherFile.txt" For Append as #2
Print #2, "Hello World"
Seek #2, 1
Print #2, "Here at the begining"
Close #2
    
            </div>
                <div id="ex-using">
            "
'
' Using blocks are mapped to with blocks.
Using A As Object.Value
    b = A.Result()
End Using
    
            </div>
</div>

<script>
        function getExample(name) {
        //
        // Get the text
        let e = null;
        if (name == 'initial') {
            e = $('#ex-general')[0];
        } else {
            e = $('#ex-' + name)[0];
        }
        vbeditor.session.setValue(unescape(e.innerHTML));
        //
        // Set the context
        let context = e.attributes['context'];
        if ($('#context')[0]) {
            if (context == null) {
                $('#context')[0].value = 'code';
            } else {
                $('#context')[0].value = context.textContent;
            }
        }
        if (name !== 'initial') {
            convert_code('Demo');
            if (!DEVELOPMENT) {
                gtag('event', 'Example', {
                    'event_category': 'Example',
                    'event_label': name,
                });
            }
        }
    }
</script>

<script>
    var DEVELOPMENT = true; //!location.host.startsWith('vb2py');
    var HOST;
    if (DEVELOPMENT) {
        HOST = 'http://localhost:8090';
    } else {
        //HOST = 'http://vb2py.dyndns.org:8090';
        HOST = 'http://23.99.213.204:8090';
    }

    let pyeditor = null;
    let vbeditor = null;

    $(document).ready(function () {
        vbeditor = ace.edit("vbcode");
        vbeditor.setTheme("ace/theme/dawn");
        vbeditor.session.setMode("ace/mode/vbscript");
        pyeditor = ace.edit("pycode");
        pyeditor.setTheme("ace/theme/dawn");
        pyeditor.session.setMode("ace/mode/python");

        // Set the initial example
        getExample('initial');

        // Enable tooltips
        $(function () {
          $('[data-toggle="tooltip"]').tooltip()
        })

        // Hide button labels
        $('.button-label').hide();

        // Enable toasts
        $('.toast').toast({'autohide': false});
    });


</script>

<script>

    var vb_marker = null;
    var py_marker = null;
    let conversion_expected_duration = 0.0;
    let conversion_total_lines = 0.0;
    let conversion_total_duration = 0.0;
    let conversion_callback_interval = 500.0;
    let conversion_show_progress = true;
    let conversion_bar = null;
    let start_time = null;
    let py_to_vb_lookup = {};

    $(document).ready(function () {
        conversion_bar = $('#progress-indicator');
    });

    function convert_selection() {
        let range = vbeditor.selection.getRange();
        let selected_text = vbeditor.getSession().doc.getTextRange(range);
        //
        // If nothing was selected then just do the current line
        if (selected_text.length == 0) {
            range.start.column = 0;
            range.end.column = 1000;
            selected_text = vbeditor.getSession().doc.getTextRange(range);
        }
        convert_text(selected_text, range.start.row, 'Selection');
    }

    function convert_code(category) {
        let vbtext = vbeditor.getValue();
        convert_text(vbtext, 0, category);
    }

    function convert_text(vbtext, selection_offset, category) {
        show_start_conversion(vbtext);

        var context = $('#context')[0].value;
        var type = $('#type')[0].value;
        var class_name = $('#class-name')[0].value;
        var number_of_lines = vbtext.split(/\r\n|\r|\n/).length;

        var language = 'Unset Language';

        var url;
        if (context == 'code') {
            url = '/single_code_module';
        } else if (context == 'class') {
            url = '/single_class_module';
        } else {
            url = '/single_form_module';
        }
        var conversion_style;
        if (type == 'exact') {
            conversion_style = 'vb';
        } else {
            conversion_style = 'pythonic';
        }

        // Clear old markers and errors
        if (vb_marker != null) {
            vbeditor.session.removeMarker(vb_marker);
        }
        if (py_marker != null) {
            pyeditor.session.removeMarker(py_marker);
        }

        for (item in vbeditor.session.getMarkers(true)) {
            vbeditor.session.removeMarker(item)
        }
        for (item in pyeditor.session.getMarkers(true)) {
            pyeditor.session.removeMarker(item)
        }
        let failure_mode = $('#failure-mode')[0].value;
        let dialect = $('#dialect')[0].value;

        let config = getConfigAsJSON();

        if (!DEVELOPMENT && window.performance) {
            start_time = window.performance.now();
        }

        $.post(HOST + url, {
            'text': vbtext, 'style': conversion_style, 'class_name': class_name,
            'failure-mode': failure_mode, 'dialect': dialect, 'options': config,
            'return-structure': 'methods', 'return-line-numbers': 1,
        }, function (data) {
            if (!DEVELOPMENT && window.performance) {
                let end_time = window.performance.now();
                let duration = end_time - start_time;
                let label = (data.parsing_failed ? "Parsing Failed" : "Succeeded");
                gtag('event', 'timing_complete', {
                    'name': 'Conversion',
                    'value': duration,
                    'event_category': category,
                    'event_label': label,
                })
            }
            if (data.status === 'OK') {
                pyeditor.session.setValue(data.result);
                let vb_error_list = $('#error-list')[0];
                vb_error_list.innerHTML = '';
                py_to_vb_lookup = data.line_number_lookup;
                // Watch for parsing failure
                if (data.parsing_failed) {
                    show_stop_conversion('parsing-failed');
                    for (i = 0; i < data.parsing_stopped_vb.length; i++) {
                        let vb_offset = data.parsing_stopped_vb[i] + selection_offset;
                        let py_offset = data.parsing_stopped_py[i];
                        let Range = ace.require('ace/range').Range;
                        vb_marker = vbeditor.session.addMarker(new Range(vb_offset, 0, vb_offset, 100),
                                "errorMarker", "line", true);
                        py_marker = pyeditor.session.addMarker(new Range(data.parsing_stopped_py[i], 0, data.parsing_stopped_py[i], 100),
                                "errorMarker", "line", true);

                        if (i === 0) {
                            vbeditor.scrollToLine(vb_offset);
                            pyeditor.scrollToLine(data.parsing_stopped_py);
                        }
                    }

                    language = data.language;

                } else {
                    show_stop_conversion('succeeded');
                }
                create_tree_from_structure(data.structure,
                        data.parsing_stopped_vb, data.parsing_stopped_py, selection_offset);
                if (!DEVELOPMENT) {
                    let label = (data.parsing_failed ? "Parsing Failed" : "Succeeded");
                    gtag('event', 'Convert', {
                        'event_category': category + '(' + data.language + ')',
                        'event_label': label,
                        'parameter1': data.language,
                        'value': number_of_lines
                    });
                }
            } else {
                show_stop_conversion('parsing-failed');
                alert('Came back ' + data.status + ': ' + data.result);
                if (!DEVELOPMENT) {
                    gtag('event', 'Convert', {
                        'event_category': category,
                        'event_label': "Server Status Error: " + data.status + ", " + data.result,
                    });
                }
                ;
            }
        }, 'json')
                .fail(function (data, status, error) {
                    show_stop_conversion('server-error');
                    pyeditor.session.setValue('There was an error talking to the server\nStatus=' +
                            status + '\n' + 'Error=' + error);
                    if (!DEVELOPMENT) {
                        gtag('event', 'Convert', {
                            'event_category': category,
                            'event_label': "Server AJAX Error - " + error + " - " + status + " = " +
                                    vbtext.split('\n').length,
                        });
                    }
                    ;
                    $.get(HOST + '/server_log?text=Ajax Failure');
                });
    }

    function estimateTime(text) {
        // Return an estimate of how long it will take to convert
        return 0.2 * 0.0189 * text.split('\n').length + 0.1;
    }

    function show_start_conversion(text) {
        conversion_expected_duration = estimateTime(text);
        conversion_total_lines = vbeditor.session.getValue().split('\n').length;
        conversion_total_duration = 0.0;
        setTimeout(updateProgress, conversion_callback_interval);
        conversion_show_progress = true;
        conversion_bar.css('width', '0%');
        conversion_bar.removeClass('bg-warning');
        conversion_bar.removeClass('bg-danger');
        conversion_bar.removeClass('bg-success');
        conversion_bar.addClass('bg-info');
        $('#conversion-progress-toast').toast('show');
        $('#progress-text')[0].innerHTML = 'Starting ...';
    }

    function show_stop_conversion(result) {
        conversion_show_progress = false;
        conversion_bar.removeClass('bg-info');
        if (result === 'succeeded') {
            conversion_bar.addClass('bg-success');
            $('#conversion-progress-toast').toast('hide');
        } else if (result === 'parsing-failed') {
            conversion_bar.addClass('bg-warning');
            $('#progress-text')[0].innerHTML = 'Some parsing errors occurred';
        } else {
            conversion_bar.addClass('bg-danger');
            $('#progress-text')[0].innerHTML = 'A server error occurred';
        }
    }

    function updateProgress() {
        if (conversion_show_progress) {
            let url = '/request_status';
            $.get(HOST + url, function (data) {
                if (data.status === 'OK') {
                    let pc_done = 100.0 * data.line_number / conversion_total_lines;
                    $('.progress-bar').css('width', pc_done.toString() + '%').attr('aria-valuenow', pc_done.toString());
                    $('#progress-text')[0].innerHTML = data.stage + ' line ' + data.line_number.toString() +
                            ' / ' + conversion_total_lines.toString()
                    setTimeout(updateProgress, conversion_callback_interval);
                }
            }, 'json');
        } else {
            $('.progress-bar').css('width', '100%');
        }
    }

</script>

<!-- Pop-up options dialog -->
<div class="modal fade" id="conversion-options" tabindex="-1" role="dialog"
     aria-labelledby="advanced-options-button"
     aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Advanced Options</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <ul class="list-group list-group-flush">
                    <li class="list-group-item">
                        <div class="form-group row"> <!-- Advanced Options -->
                            <label class="col-sm-4 col-form-label">
                                Function returns
                            </label>
                            <select class="form-control col-sm-7" id="Cfg-Functions-JustUseReturnStatement">
                                <option selected value="No">Use temporary variable</option>
                                <option value="Yes">Use return statement only (.NET)</option>
                            </select>
                        </div>

                        <div class="form-group row">
                            <label class="col-sm-4 col-form-label">
                                Return variable
                            </label>
                            <select class="form-control col-sm-7" id="Cfg-Functions-PreInitializeReturnVariable">
                                <option selected value="Yes">Pre-initialise (safe)</option>
                                <option value="No">Do not initialise</option>
                            </select>
                        </div>

                        <div class="form-group row">
                            <label class="col-sm-4 col-form-label">
                                Variable name
                            </label>
                            <input type="text" class="form-control col-sm-7" id="Cfg-Functions-ReturnVariableName"
                                   value="fn_return_value">
                        </div>
                    </li>

                    <li class="list-group-item">
                        <div class="form-group row">
                            <label class="col-sm-4 col-form-label">
                                Literals
                            </label>
                            <select class="form-control col-sm-7" id="Cfg-Classes-ExplicitlyTypeLiterals">
                                <option value="No">Use Python literals</option>
                                <option selected value="Yes">Explicitly declare as objects</option>
                            </select>
                        </div>

                        <div class="form-group row">
                            <label class="col-sm-4 col-form-label">
                                Private Variables
                            </label>
                            <select class="form-control col-sm-7" id="Cfg-General-RespectPrivateStatus">
                                <option selected value="Yes">Respect VB scope</option>
                                <option value="No">Make all public</option>
                            </select>
                        </div>
                    </li>
                    <li class="list-group-item">

                        <div class="form-group row">
                            <label class="col-sm-4 col-form-label">
                                Select variable
                            </label>
                            <select class="form-control col-sm-7" id="Cfg-Select-EvaluateVariable">
                                <option selected value="Smart">Guess best approach</option>
                                <option value="Once">Create temp variable</option>
                                <option value="EachTime">Evaluate each time</option>
                            </select>
                        </div>

                        <div class="form-group row">
                            <label class="col-sm-4 col-form-label">
                                Select name
                            </label>
                            <select class="form-control col-sm-7" id="Cfg-Select-UseNumericIndex">
                                <option selected value="Yes">Make unique</option>
                                <option value="No">Reuse (fails if nested)</option>
                            </select>
                        </div>

                        <div class="form-group row">
                            <label class="col-sm-4 col-form-label">
                                Name prefix
                            </label>
                            <input type="text" class="form-control col-sm-7" id="Cfg-Select-SelectVariablePrefix"
                                   value="select_">
                        </div>
                    </li>
                    <li class="list-group-item">

                        <div class="form-group row">
                            <label class="col-sm-4 col-form-label">
                                With variable
                            </label>
                            <select class="form-control col-sm-7" id="Cfg-With-EvaluateVariable">
                                <option selected value="Once">Create temp variable</option>
                                <option value="EveryTime">Evaluate each time</option>
                            </select>
                        </div>

                        <div class="form-group row">
                            <label class="col-sm-4 col-form-label">
                                With name
                            </label>
                            <select class="form-control col-sm-7" id="Cfg-With-UseNumericIndex">
                                <option selected value="Yes">Make unique</option>
                                <option value="No">Reuse (fails if nested)</option>
                            </select>
                        </div>

                        <div class="form-group row">
                            <label class="col-sm-4 col-form-label">
                                Name prefix
                            </label>
                            <input type="text" class="form-control col-sm-7" id="Cfg-With-WithVariablePrefix"
                                   value="with_">
                        </div>
                    </li>

                </ul>

                <div class="modal-footer">
                    <button type="button" class="btn btn-danger" onclick="restoreDefaultConfig()">Defaults</button>
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-info" onclick="applyConfigChanges(false)">Save</button>
                    <button type="button" class="btn btn-primary" onclick="applyConfigChanges(true)">Save and Convert
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>


<script>

    //region Storing and reloading configuration
    function applyConfigChanges(also_convert_code) {
        $('.form-control').each(function (idx, item) {
            if (item.id.startsWith('Cfg-')) {
                setCookie(item.id.substr(4), item.value, 365);
            }
        });
        $('#conversion-options').modal('hide');
        if (also_convert_code) {
            convert_code();
        }
    }

    function restoreDefaultConfig() {
        default_config.forEach(function (item) {
            $('#' + item[0])[0].value = item[1];
        })
    }

    function loadConfigFromCookie() {
        $('.form-control').each(function (idx, item) {
            if (item.id.startsWith('Cfg-')) {
                let value = getCookie(item.id.substr(4));
                if (value !== "") {
                    item.value = value;
                }
            }
        })
    }

    function getConfigAsJSON() {
        let result = '';
        $('.form-control').each(function (idx, item) {
            if (item.id.startsWith('Cfg-')) {
                let value = getCookie(item.id.substr(4));
                if (value !== "") {
                    let name = item.id.split('-');
                    if (result !== '') {
                        result += ', ';
                    }
                    result += (
                        '["' + name[1] + '", ' +
                        '"' + name[2] + '", ' +
                        '"' + item.value + '"]'
                    );
                }
            }
        })
        return '[' + result + ']';
    }

    function recordOptionsOpen() {
        if (!DEVELOPMENT) {
            gtag('event', 'Options', {
                'event_category': 'Open Options',
            });
        }
    }
    //endregion

    //region Cookie Handling
    function setCookie(cname, cvalue, exdays) {
        var d = new Date();
        d.setTime(d.getTime() + (exdays * 24 * 60 * 60 * 1000));
        var expires = "expires=" + d.toUTCString();
        document.cookie = cname + "=" + cvalue + ";" + expires + ";path=/";
    }

    function getCookie(cname) {
        var name = cname + "=";
        var ca = document.cookie.split(';');
        for (var i = 0; i < ca.length; i++) {
            var c = ca[i];
            while (c.charAt(0) === ' ') {
                c = c.substring(1);
            }
            if (c.indexOf(name) === 0) {
                return c.substring(name.length, c.length);
            }
        }
        return "";
    }
    //endregion

</script>
<div id="conversion-progress-toast" class="toast shadow" role="alert" aria-live="assertive" aria-atomic="true"
     style="position: absolute; top: 50px; right: 50px;width: 500px; background-color: darkgray">
  <div class="toast-header">
    <i data-feather="cpu"></i>
    <strong class="mr-auto">&nbsp;Converting to Python</strong>
    <button type="button" class="ml-2 mb-1 close" data-dismiss="toast" aria-label="Close">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  <div class="toast-body">
    <!-- Progress Indicator -->
    <div class="progress" style="height: 20px;">
        <div id="progress-indicator" class="progress-bar bg-success" role="progressbar" style="width: 100%;transition:none;display: block" aria-valuenow="0" aria-valuemin="100" aria-valuemax="100"></div>
    </div>
    <div id="progress-text"></div>
  </div>
</div>


<div class="modal" tabindex="-1" role="dialog" id="load-file-modal">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Load File</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="input-group mb-3">
                    <div class="input-group-prepend">
                        <span class="input-group-text" id="inputGroupFileAddon01">Load File</span>
                    </div>
                    <div class="custom-file">
                        <input type="file" class="custom-file-input" id="inputGroupFile01"
                               aria-describedby="inputGroupFileAddon01" onchange="openFile(event)">
                        <label class="custom-file-label" for="inputGroupFile01">Choose file</label>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
            </div>
        </div>
    </div>
</div>


<script>
    function openFile(event) {
        $('#load-file-modal').modal('hide');
        var input = event.target;
        var reader = new FileReader();
        reader.onload = function () {
            var text = reader.result;
            vbeditor.session.setValue(text);
        };

        if (input.files.length != 0) {
            reader.readAsText(input.files[0]);
            let extn = input.files[0].name.toLowerCase();
            let context = $('#context')[0];
            let class_name = $('#class-name')[0];
            let chosen_name = input.files[0].name.split('.')[0];
            chosen_name = chosen_name.replace(/ /g, "_");
            if (extn.endsWith('.frm')) {
                context.selectedIndex = 2;
                class_name.value = chosen_name;
            } else if (extn.endsWith('.cls')) {
                context.selectedIndex = 1;
                class_name.value = chosen_name;
            } else if (extn.endsWith('.vb')) {
                context.selectedIndex = 1;
                class_name.value = chosen_name;
            } else {
                context.selectedIndex = 0;
            }
            if (!DEVELOPMENT) {
                gtag('event', 'Load', {
                    'event_category': 'File',
                    'event_label': extn.split(".")[1],
                });
            }
        }
    };
</script>



        <div class="footer">
            

            
        </div>

        <!-- Render Feather icons -->
        <script>
          feather.replace({class: "feather-icon"})
        </script>

    </body>
</html>